<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Web Chat Sederhana</title>
  <link rel="stylesheet" href="style/style.css">
</head>
<body>
  <div class="chat-container">
    <div id="chatbox"></div>
    <input type="text" id="message" placeholder="Tulis pesan...">
    <button onclick="sendChat()">Kirim</button>
  </div>
 <script>
    // Cek login
    if (!localStorage.getItem("username")) {
      window.location.href = "login.html";
    }

    // Koneksi ke Supabase
    const supabaseUrl = 'https://xxxx.supabase.co'; // ganti dengan URL kamu
    const supabaseKey = 'anon_public_key_kamu';     // ganti dengan key kamu
    const supabase = supabase.createClient(supabaseUrl, supabaseKey);

    const username = localStorage.getItem("username");

    async function loadChat() {
      const { data, error } = await supabase
        .from('chats')
        .select('*')
        .order('created_at', { ascending: true });
      const chatbox = document.getElementById('chatbox');
      chatbox.innerHTML = '';
      if(data) {
        data.forEach(c => {
          chatbox.innerHTML += `<p><b>${c.name}:</b> ${c.text}</p>`;
        });
      }
    }

    async function sendChat() {
      const text = document.getElementById('message').value;
      if (!text.trim()) return;
      await supabase
        .from('chats')
        .insert([{ name: username, text: text }]);
      document.getElementById('message').value = '';
      loadChat();
    }

    setInterval(loadChat, 2000);
    loadChat();
</script>
</body>
</html>
